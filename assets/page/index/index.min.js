"use strict";require(["/assets/page/index/vendors/cash.min.js"],function(a){window.$cash=a});var demo=function(){function a(){s()}function n(){e(pattern),t()}function e(a){$cash(p.pattern).append(a),u.paths=[].slice.call(a.childNodes),u.points=[],u.paths.forEach(function(a){$cash(a).attr("class",l.polygon);var n=a.getBoundingClientRect(),e={x:n.left+n.width/2,y:n.top+n.height/2};u.points.push(e)}),$cash(p.pattern).removeClass(l.patternHidden)}function t(){var a=$(".main-wrapper"),n=a.find(".card");n.each(function(a){var n=new Card(a,this);f[a]={card:n}})}function r(a,n,e){var t=f[n].card;if(!t.isOpen||!a){var r=new TimelineLite({paused:!0}),c=i(n);if(t.isOpen){var s=t.closeCard(),p=.8*s.duration();r.add(s),r.add(c,p)}else d(e.target),r.add(c),r.add(t.openCard(o),0);r.play()}}function i(a){var n=new TimelineLite,e=f[a].card;for(var t in f){var r=f[t].card;r.id===a||e.isOpen||n.add(r.hideCard(),0),r.id!==a&&e.isOpen&&n.add(r.showCard(),0)}return n}function d(a){var n=$cash(a).attr("xlink:href");$cash(p.pattern).css("background-image","url("+n+")")}function o(a){var n=a.width/2,e={x:a.x,y:a.y};u.points.forEach(function(a,t){c(a,n,e)?$cash(u.paths[t]).attr("class",l.polygon+" "+l.polygonHidden):$cash(u.paths[t]).attr("class",l.polygon)})}function c(a,n,e){var t=a.x,r=a.y,i=e.x,d=e.y,o=n*n,c=Math.pow(t-i,2)+Math.pow(r-d,2)<=o;return c}function s(){var a,n=$(".main-wrapper"),e=$(".navbar-inverse");n.on("click",".card "+p.cardImage,function(t){var i=$(this),d=i.parents(".card"),o=d.find("iframe"),c=n.find(".card");a=c.index(d),d.parents(".main-wrapper").find(".X_loadMore").addClass("animate"),e.addClass("animate"),o.length>0&&(o[0].src=o.attr("data-src")),r.bind(d[0],!0,a)(t)}),n.on("click",".card "+p.cardClose,function(t){var i=$(this),d=i.parents(".card"),o=n.find(".card");a=o.index(d),r.bind(d[0],!1,a)(t),setTimeout(function(){d.parents(".main-wrapper").find(".X_loadMore").removeClass("animate"),e.removeClass("animate")},2500)})}var p={pattern:".pattern",card:".card",cardImage:".card__image",cardClose:".card__btn-close"},l={patternHidden:"pattern--hidden",polygon:"polygon",polygonHidden:"polygon--hidden"},u={paths:null,points:null},f={};return{init:a,update:n}}(window);window.onload=demo.init(),require(["jQuery","js/util/underscore","vendor/jquery.qrcode.min","js/util/xhr","js/util/scrollLoad","js/util/loading","text!page/index/card.tpl.html","text!page/index/cards.json","text!/cardsTpl/app-page.html"],function(a,n,e,t,r,i,d,o,c){a(function(){function e(a){s(a||[],u)}function t(a){alert(a)}function s(e,t){var r="",i=e[0];r+=p(i);var d=a(r);i.filter&&(n.isArray(i.filter)?n.each(i.filter,function(a){d.addClass(a)}):d.addClass(i.filter)),i.wrapper&&i.wrapper.class&&d.find(".card__content").addClass(i.wrapper.class),i.class&&d.find(".card__copy .custom_content").addClass(i.class);var o=d.find(".qrcode");o.length>0&&o.qrcode(o.attr("data-text")),t.append(d)}function p(a){return n.template(d)(a)}function l(a){window.generatorTpl={};var e=window.generator={page:function(){var e='                    <iframe class="custom_content" frameborder="0" data-src="<%= url %>"></iframe>                    ';return n.template(e)(a)},"app-page":function(){return n.template(c)(a)},"default":function(){console.error("generate content on default")}};return e[a.type]?e[a.type]():e["default"]()}window.pattern=Trianglify({width:window.innerWidth,height:window.innerHeight,cell_size:90,variance:1,stroke_width:1,x_colors:"random"}).svg();var u=a(".main-wrapper .wrapper"),f=i({container:u.parent()}),h=JSON.parse(o),m=h&&h.includes.length,g=function(){var n=!0,e=0,t=[],r=6,i=!1;return window.cardIndex=0,function(d,o){if(!i&&a.isFunction(d)&&a.isFunction(o)&&n){f.begin();for(var c=h.includes.slice(e,e+r),s=0;r>s;s++){var p=c[s];p&&require(["text!/cardsJson/"+p+".json"],function(a){var a=JSON.parse(a);a.index=e+cardIndex,a.content=l(a),a.image=a.image?"/images/card/"+a.image:"/images/card/default/"+parseInt(Math.random()*h.image.default.total+1)+".jpg",t.push(a),d([a]),cardIndex+=1,demo.update()})}f.stop(),n=m>e+r?!0:!1,n?e+=r:f.finish()}}}();g(e,t),r.initHandler(function(){g(e,t)})})});